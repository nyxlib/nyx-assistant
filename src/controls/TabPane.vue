<script setup>
/*--------------------------------------------------------------------------------------------------------------------*/

import {ref, watch, inject, onMounted, onUnmounted} from 'vue';

import * as uuid from 'uuid';

/*--------------------------------------------------------------------------------------------------------------------*/
/* VARIABLES                                                                                                          */
/*--------------------------------------------------------------------------------------------------------------------*/

const addTab = inject('addTab');
const delTab = inject('delTab');

const updateTitle = inject('updateTitle');
const updateIcon = inject('updateIcon');

/*--------------------------------------------------------------------------------------------------------------------*/

const props = defineProps({
    title: {
        type: String,
        required: true,
    },
    icon: {
        type: String,
        default: '',
    },
    tabClass: {
        type: String,
        default: '',
    },
    rank: {
        type: Number,
        default: -1,
    }
});

/*--------------------------------------------------------------------------------------------------------------------*/

const emit = defineEmits([
    'show', 'shown',
    'hide', 'hidden',
]);

/*--------------------------------------------------------------------------------------------------------------------*/

const isFirst = ref(false);

/*--------------------------------------------------------------------------------------------------------------------*/

const tabId = `nyx_tab_${uuid.v4()}`;

/*--------------------------------------------------------------------------------------------------------------------*/
/* FUNCTIONS                                                                                                          */
/*--------------------------------------------------------------------------------------------------------------------*/

const onShow = (e) => {

    emit('shown', e);
};

const onShown = (e) => {

    emit('shown', e);
};

const onHide = (e) => {

    emit('hidden', e);
};

const onHidden = (e) => {

    emit('hidden', e);
};

/*--------------------------------------------------------------------------------------------------------------------*/
/* INITIALIZATION                                                                                                     */
/*--------------------------------------------------------------------------------------------------------------------*/

onMounted(() => {

    isFirst.value = addTab(tabId, props.rank, props.title, props.icon, props.tabClass, onShow, onShown, onHide, onHidden);

    watch(() => props.title, (title) => {

        updateTitle(tabId, title);
    });

    watch(() => props.icon, (icon) => {

        updateIcon(tabId, icon);
    });
});

/*--------------------------------------------------------------------------------------------------------------------*/

onUnmounted(() => {

    delTab(tabId);
});

/*--------------------------------------------------------------------------------------------------------------------*/
</script>

<template>

    <!-- *********************************************************************************************************** -->

    <div :class="['tab-pane', 'h-100', {'show': isFirst, 'active': isFirst}]" :id="tabId">

        <slot></slot>

    </div>

    <!-- *********************************************************************************************************** -->

</template>
